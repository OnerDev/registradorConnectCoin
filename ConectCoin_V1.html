<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConectCoins - Coral de Jovens Petra Life AD Jaderl√¢ndia</title>
    <style>
        :root { --primary: #6c5ce7; --sec: #00b894; --adm: #e17055; --bg: #f4f7f6; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 0; }
        
        /* HEADER COM √çCONE DE SAIR */
        header { 
            background: var(--primary); 
            color: white; 
            padding: 20px; 
            text-align: center; 
            position: relative; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .btn-sair-icon { 
            position: absolute; 
            right: 15px; 
            top: 50%; 
            transform: translateY(-50%);
            background: rgba(255,255,255,0.15); 
            border: none; 
            color: white; 
            font-size: 15px; 
            cursor: pointer; 
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            transition: 0.3s;
        }
        
        .btn-sair-icon:hover { 
            background: rgba(255, 255, 255, 0.3); 
            transform: translateY(-50%) scale(1.1);
        }

        .container { max-width: 500px; margin: 20px auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .hidden { display: none; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; margin-top: 10px; }
        
        .btn-login { background: var(--primary); }
        .btn-presenca { background: var(--sec); }
        .btn-adm { background: var(--adm); }
        .btn-link { background: none; color: var(--primary); text-decoration: underline; margin-top: 15px; font-size: 14px; width: auto; padding: 0; display: block; margin-left: auto; margin-right: auto; }
        
        .card-saldo { background: #eee; text-align: center; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        
        .tema-container { margin-top: 25px; padding: 15px; background: #f1f2f6; border-radius: 8px; border-left: 5px solid var(--primary); text-align: center; }
        .tema-titulo { font-size: 11px; color: #666; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; display: block; }
        .tema-texto { font-weight: bold; color: var(--primary); font-size: 15px; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { text-align: left; padding: 10px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<header>
    <h1>ConectCoins ü™ô</h1>
    <div id="status-user"></div>
    <button id="logout-btn" class="btn-sair-icon hidden" title="Sair da conta" onclick="logout()">sair
    </button>
</header>

<div id="tela-login" class="container">
    <h2>Entrar</h2>
    <input type="email" id="email" placeholder="Seu Email">
    <input type="password" id="senha" placeholder="Sua Senha">
    <button class="btn-login" onclick="executarLogin()">Acessar Sistema</button>
    <button class="btn-link" onclick="mostrarCadastro()">N√£o tem conta? Criar conta</button>

    <div class="tema-container">
        <span class="tema-titulo">Tema do Trimestre</span>
        <div class="tema-texto">"Firmados na Rocha, Edificando o Futuro"</div>
    </div>
</div>

<div id="tela-auto-cadastro" class="container hidden">
    <h2>Criar Minha Conta</h2>
    <p style="font-size: 14px; color: #666;">Cadastre-se para participar e ganhar moedas ConectCoins!</p>
    <input type="text" id="self-nome" placeholder="Nome Completo">
    <input type="email" id="self-email" placeholder="Seu melhor Email">
    <input type="password" id="self-senha" placeholder="Crie uma Senha">
    <button class="btn-presenca" onclick="enviarAutoCadastro()">Finalizar Cadastro</button>
    <button class="btn-link" onclick="mostrarLogin()">Voltar para o Login</button>
</div>

<div id="painel-jovem" class="container hidden">
    <div class="card-saldo">
        <p>Meu Saldo Atual</p>
        <h1 id="meu-saldo">0</h1>
    </div>
    <h3>üèÜ Ranking</h3>
    <table id="tabela-ranking">
        <thead><tr><th>#</th><th>Nome</th><th>Saldo</th></tr></thead>
        <tbody></tbody>
    </table>
</div>

<div id="painel-lider" class="container hidden">
    <h3>üìç Registrar Presen√ßa</h3>
    <p>Selecione o jovem e o tipo de participa√ß√£o:</p>
    <select id="lista-jovens"></select>
    <select id="tipo-ativ">
        <option>Culto</option>
        <option>EBD</option>
        <option>Conectados</option>
        <option>Reuni√£o</option>
        <option>Ensaio</option>
        <option>Eventos</option>
    </select>
    <button class="btn-presenca" onclick="enviarPresenca()">Confirmar (+ C$50)</button>
</div>

<div id="painel-adm" class="container hidden">
    <h3 style="color: var(--adm)">‚öôÔ∏è Cadastro de Usu√°rios (ADM)</h3>
    <input type="text" id="cad-nome" placeholder="Nome Completo">
    <input type="email" id="cad-email" placeholder="Email do Usu√°rio">
    <input type="password" id="cad-senha" placeholder="Senha Tempor√°ria">
    <select id="cad-tipo">
        <option value="jovem">Jovem</option>
        <option value="lider">L√≠der</option>
        <option value="adm">Administrador</option>
    </select>
    <button class="btn-adm" onclick="enviarCadastro()">Cadastrar no Sistema</button>
</div>

<script>
    const URL_API = "https://script.google.com/macros/s/AKfycbybWUVf5VYgGrGuAJ7WmWZNhzqjJIPxgG3EFI5lMEILYnFVGwug6RJ18q5514k5GqK3Cg/exec"; 
    let listaUsuarios = [];

    function logout() {
        if(confirm("Deseja sair da sua conta?")) {
            location.reload();
        }
    }

    function mostrarCadastro() {
        document.getElementById('tela-login').classList.add('hidden');
        document.getElementById('tela-auto-cadastro').classList.remove('hidden');
    }

    function mostrarLogin() {
        document.getElementById('tela-auto-cadastro').classList.add('hidden');
        document.getElementById('tela-login').classList.remove('hidden');
    }

    async function executarLogin() {
        const btn = document.querySelector('.btn-login');
        btn.innerText = "Carregando...";
        
        try {
            const res = await fetch(URL_API);
            listaUsuarios = await res.json();
            
            const email = document.getElementById('email').value.trim().toLowerCase();
            const senha = document.getElementById('senha').value;
            const user = listaUsuarios.find(u => u.email.toLowerCase() === email && String(u.senha) === senha);

            if (!user) {
                alert("Acesso negado! Verifique seu email e senha.");
                btn.innerText = "Acessar Sistema";
                return;
            }

            document.getElementById('tela-login').classList.add('hidden');
            document.getElementById('logout-btn').classList.remove('hidden'); // MOSTRA O √çCONE
            document.getElementById('status-user').innerText = `Ol√°, ${user.nome}!`;

            if (user.tipo === 'jovem') carregarJovem(user);
            if (user.tipo === 'lider' || user.tipo === 'adm') carregarLider();
            if (user.tipo === 'adm') document.getElementById('painel-adm').classList.remove('hidden');
        } catch(e) {
            alert("Erro de conex√£o.");
            btn.innerText = "Acessar Sistema";
        }
    }

    // Mantive o restante das fun√ß√µes carregarJovem, carregarLider, enviarAutoCadastro, enviarPresenca e enviarCadastro id√™nticas ao c√≥digo anterior.
    function carregarJovem(u) {
        document.getElementById('painel-jovem').classList.remove('hidden');
        document.getElementById('meu-saldo').innerText = u.saldo + " CC";
        const ranking = [...listaUsuarios].filter(x => x.tipo === 'jovem').sort((a,b) => b.saldo - a.saldo);
        document.querySelector("#tabela-ranking tbody").innerHTML = ranking.map((x, i) => 
            `<tr><td>${i+1}¬∫</td><td>${x.nome}</td><td>${x.saldo}</td></tr>`
        ).join('');
    }

    function carregarLider() {
        document.getElementById('painel-lider').classList.remove('hidden');
        const select = document.getElementById('lista-jovens');
        const jovens = listaUsuarios.filter(u => u.tipo === 'jovem');
        select.innerHTML = jovens.map(j => `<option value="${j.email}">${j.nome}</option>`).join('');
    }

    async function enviarAutoCadastro() {
        const dados = { acao: 'cadastrar', nome: document.getElementById('self-nome').value, email: document.getElementById('self-email').value.trim().toLowerCase(), senha: document.getElementById('self-senha').value, tipo: 'jovem' };
        if(!dados.nome || !dados.email || !dados.senha) return alert("Por favor, preencha todos os campos!");
        await fetch(URL_API, { method: 'POST', mode: 'no-cors', body: JSON.stringify(dados) });
        alert("Conta criada com sucesso!");
        mostrarLogin();
    }

    async function enviarPresenca() {
        const email = document.getElementById('lista-jovens').value;
        const atividade = document.getElementById('tipo-ativ').value;
        await fetch(URL_API, { method: 'POST', mode: 'no-cors', body: JSON.stringify({acao: 'presenca', email: email, atividade: atividade}) });
        alert("Presen√ßa registrada!");
        location.reload();
    }

    async function enviarCadastro() {
        const dados = { acao: 'cadastrar', nome: document.getElementById('cad-nome').value, email: document.getElementById('cad-email').value.trim().toLowerCase(), senha: document.getElementById('cad-senha').value, tipo: document.getElementById('cad-tipo').value };
        await fetch(URL_API, { method: 'POST', mode: 'no-cors', body: JSON.stringify(dados) });
        alert("Usu√°rio cadastrado!");
        location.reload();
    }
</script>
</body>
</html>